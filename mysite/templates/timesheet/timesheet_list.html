{% extends "base.html" %}
{% load static %}
{% block content %}
{% load timedelta_filter %}

<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css'>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/gijgo@1.9.6/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/npm/gijgo@1.9.6/css/gijgo.min.css" rel="stylesheet" type="text/css" />
<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
<style>
#chartdiv {
  width: 100%;
  height: 500px;
}
.week-select .input-group-addon {
  cursor: pointer;
}
.datepicker table tr td.week {
  background: #e9e9e9;
}
.datepicker table tr td.week-active,
.datepicker table tr td.week-active:hover,
.datepicker table tr td.week-active td.week,
.datepicker table tr td.week-active td.week:hover,
.datepicker table tr td.week-active td:hover {
  background-color: #006dcc;
  background-image: -moz-linear-gradient(top, #0088cc, #0044cc);
  background-image: -ms-linear-gradient(top, #0088cc, #0044cc);
  background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#0088cc), to(#0044cc));
  background-image: -webkit-linear-gradient(top, #0088cc, #0044cc);
  background-image: -o-linear-gradient(top, #0088cc, #0044cc);
  background-image: linear-gradient(top, #0088cc, #0044cc);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#0088cc', endColorstr='#0044cc', GradientType=0);
  border-color: #0044cc #0044cc #002a80;
  border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
  filter: progid:DXImageTransform.Microsoft.gradient(enabled=false);
  color: #fff;
  text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
}
</style>


                    <!-- Start Content-->
                    <div class="container-fluid">

                       <!-- start page title -->
                       <div class="row">
                        <div class="col-12">
                            <div class="page-title-box">
                                <div class="page-title-right">

                                </div>
                                <h4 class="page-title">Timesheets List</h4>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

      <form method="post" onsubmit="submitForm(event)">
    {% csrf_token %}
                        <div class="row">
                            <div class="col-12">

                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                <div class="mb-3 col-md-6">
                                    <label for="inputState" class="form-label">Staff</label>
                                    <select name="userID" id="userID" class="form-select">
                                    <option value="000" >All</option>
                                        {% for item in candidate_list %}
                                        <option value="{{item.user.id}}">{{item.user.id}}-{{item.first_name}} {{item.last_name}}

                                        </option>
                                        {% endfor %}

                                    </select>
                                    <div><span id="mainCanIDError" class="text-danger"></span></div>
                                </div>



    <div class="col-sm-6 col-sm-offset-4">
<label for="inputState1" class="form-label">Date</label>
         <div class="input-group">
<input id="datepicker" name="daily" class="form-control" />
    </div>
    </div>
                                </div>
                                                                                    <div class="row g-2">
                                                <div class="mb-3 col-md-6">
                                                    <label for="inputCity" class="form-label">Task</label>
 <select class="form-select" name="task" id="event-category"  >
    <option value="All" >All</option>
    <option value="Administration" >Administration</option>
    <option value="Financial" >Financial</option>
    <option value="Marketing-Engineering" >Marketing-Engineering</option>
    <option value="Marketing-Training & Exam" >Marketing-Training & Exam</option>
    <option value="Sales-Engineering" >Sales-Engineering</option>
    <option value="Sales-Training & Exam" >Sales-Training & Exam</option>
    <option value="Training Services" >Training & Examination Services</option>
    <option value="Engineering Services" >Engineering Services</option>
    <option value="IT" >IT</option>
    <option value="Human Resources" >Human Resources</option>
    <option value="QHSE" >QHSE</option>
    <option value="Other" >Other</option>

</select>
                                                </div>
                                                <div class="mb-3 col-md-6">
                                                    <label for="months" class="form-label">Month</label>
                                                    <select  id="months" name="monthSelect" class="form-select">

    <option  value=''>Choose</option>
    <option  value='1'>Janaury</option>
    <option value='2'>February</option>
    <option value='3'>March</option>
    <option value='4'>April</option>
    <option value='5'>May</option>
    <option value='6'>June</option>
    <option value='7'>July</option>
    <option value='8'>August</option>
    <option value='9'>September</option>
    <option value='10'>October</option>
    <option value='11'>November</option>
    <option value='12'>December</option>

                                                    </select>
                                                </div>

                                            </div>
                           </div>



                     <div class="mb-3 col-md-12 text-center">
                                    <button  class="btn btn-primary" name="userSelection" type="submit">Update</button>
                     </div>
                     </div>
                 </div>
                                  </form>

 <form method="post">
      {% csrf_token %}
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title"> </h4>


               <div class="row g-2">                                                                                                          <div class="row g-2">
                                                <div class="mb-4 col-md-4 border border-info">
<h5>Staff Location: {{candidate.location}}</h5>
                                                </div>
                                                <div class="mb-4 col-md-4 border border-info">
 {% if conTotalHoursDaily %}
<h5>Monthly Hours: {{conTotalHoursDaily}}</h5>
{% elif  conTotalHoursDaily %}
<h5>Daily Hours: {{conTotalHoursDaily}}</h5>
{% endif %}
                                                </div>




                   <div class="mb-4 col-md-4 border border-info">
<h5>Task: {{task}}</h5>
                                                </div>

                                            </div>
                   <hr>
    {%  if  timesheets_task != null %}
                <div id="chartdiv"></div>
                   <br>
{% endif %}
                   <hr>


                   <table class="table table-striped">
    <thead>
      <tr>
        <th>Task</th>
        <th>Hours</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody>
    {% for task in timesheets_task %}
      <tr>
        <td>{{task.task}}</td>
        <td>{{task.durationTime|timedelta:"{hours_total}:{minutes}" }}</td>
        <td>{{task.task__count}}</td>
      </tr>
    {% endfor %}

    </tbody>
  </table>
                                    <br>
                   <hr>
 <h5>Month</h5>
                   <table class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Duration</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody>
    {% for task in timesheets_day %}
      <tr>
          <td>{{task.from_temp__month}}/{{task.from_temp__day}}/{{task.from_temp__year}}</td>
        <td>{{task.durationTime|timedelta:"{hours_total}:{minutes}" }}</td>

        <td>{{task.from_temp__day__count}}</td>
      </tr>
    {% endfor %}

    </tbody>
  </table>
                   <br>
                   <br>

                                    <div class="tab-content">
                                        <div class="tab-pane show active" id="basic-datatable-preview">
                                            <table id="basic-datatable" class="table dt-responsive  w-100">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Staff</th>
                                                        <td>Description</td>
                                                        <th>From</th>
                                                        <th>To</th>
                                                        <th>Duration</th>
                                                        <th>Type</th>
                                                        <th>Registered Date</th>


                                                        <th></th>
                                                        <th></th>
                                                        <th></th>
                                                    </tr>
                                                </thead>


                                                <tbody>
                                                    {% for item in timesheets %}
                                                    <tr>
                                                        <td>{{item.id}}</td>
                                                        <td>{{item.staff.first_name}} {{item.staff.last_name}}</td>
                                                        <td>{{item.description}}</td>
                                                        <td>{{item.from_temp|date:'m/d/Y H:i'}}</td>
                                                        <td>{{item.to_date|date:'m/d/Y H:i'}}</td>
                                                        <td>{{item.durationTime}}</td>
                                                        <td>{{item.task}}</td>
                                                        <td>{{item.created_at|date:'m/d/Y' }}</td>

                                                        <td>{% if item.approved %}<i style="font-size:20px;color:#1c62e6;" class="fa fa-check"></i>{% else %}<i style="font-size:20px;color:#ffc800;"  class="fa fa-clock-o" aria-hidden="true"></i>{% endif %}</td>
                                                        <td><a href="{% url 'stafftimesheet:updatetimesheet_' id=item.id %}"><i style="font-size:20px;" class="fa fa-pencil-square-o" aria-hidden="true" ></i></a></td>
														<td><a href="{% url 'stafftimesheet:deltimesheet_' pk=item.id %}"><i style="color:#660a0a;font-size:20px;" class="fa fa-times" aria-hidden="true"></i></a></td>



                                                    </tr>
                                                    {%endfor%}
                                                </tbody>
                                            </table>
                                        </div> <!-- end preview-->
                                        <br>
                                        <br>
                                        <br>





                                        <div class="tab-pane" id="basic-datatable-code">



                                            <pre class="mb-0">
                                                <span class="html escape">
                                                    &lt;table id=&quot;basic-datatable&quot; class=&quot;table dt-responsive nowrap w-100&quot;&gt;
                                                        &lt;thead&gt;
                                                            &lt;tr&gt;
                                                                &lt;th&gt;Name&lt;/th&gt;
                                                                &lt;th&gt;Position&lt;/th&gt;
                                                                &lt;th&gt;Office&lt;/th&gt;
                                                                &lt;th&gt;Age&lt;/th&gt;
                                                                &lt;th&gt;Start date&lt;/th&gt;
                                                                &lt;th&gt;Salary&lt;/th&gt;
                                                            &lt;/tr&gt;
                                                        &lt;/thead&gt;


                                                        &lt;tbody&gt;
                                                            &lt;tr&gt;
                                                                &lt;td&gt;Tiger Nixon&lt;/td&gt;
                                                                &lt;td&gt;System Architect&lt;/td&gt;
                                                                &lt;td&gt;Edinburgh&lt;/td&gt;
                                                                &lt;td&gt;61&lt;/td&gt;
                                                                &lt;td&gt;2011/04/25&lt;/td&gt;
                                                                &lt;td&gt;$320,800&lt;/td&gt;
                                                            &lt;/tr&gt;
                                                            &lt;tr&gt;
                                                                &lt;td&gt;Garrett Winters&lt;/td&gt;
                                                                &lt;td&gt;Accountant&lt;/td&gt;
                                                                &lt;td&gt;Tokyo&lt;/td&gt;
                                                                &lt;td&gt;63&lt;/td&gt;
                                                                &lt;td&gt;2011/07/25&lt;/td&gt;
                                                                &lt;td&gt;$170,750&lt;/td&gt;
                                                            &lt;/tr&gt;
                                                        &lt;/tbody&gt;
                                                    &lt;/table&gt;
                                                </span>
                                            </pre> <!-- end highlight-->
                                        </div> <!-- end preview code-->
                                    </div> <!-- end tab-content-->

                                </div> <!-- end card body-->
                            </div> <!-- end card -->
                        </div><!-- end col-->
                    </div>
                    <!-- end row-->


                     <div class="mb-3 col-md-12 text-center">
                                    <button onclick="myFunctionButtom()" class="btn btn-primary" name="calUpdate" type="submit">Approve</button>
                     </div>

                                        </div>  <!-- end row -->
                                    </div> <!-- end card body-->
                                </div> <!-- end card -->
</form>
                    </div>
                    <!-- container -->

                </div>
                <!-- content -->
                <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
                <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js'></script>

<script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.js'></script>
                <script>

// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end

// Create chart instance
var chart = am4core.create("chartdiv", am4charts.PieChart);




// Add data

chart.data = [
{% for task in timesheets_task %}
{
  "country": "{{task.task}}",
  "litres": {{task.durationTime|timedelta:"{hours_total}" }}
},

   {% endfor %}

 ];

// Add and configure Series
var pieSeries = chart.series.push(new am4charts.PieSeries());
pieSeries.dataFields.value = "litres";
pieSeries.dataFields.category = "country";
pieSeries.slices.template.stroke = am4core.color("#fff");
pieSeries.slices.template.strokeWidth = 2;
pieSeries.slices.template.strokeOpacity = 1;

// This creates initial animation
pieSeries.hiddenState.properties.opacity = 1;
pieSeries.hiddenState.properties.endAngle = -90;
pieSeries.hiddenState.properties.startAngle = -90;




function submitForm(event){
<!--alert("Test");-->

var e = document.getElementById("months");
var strUser = e.value;

var e = document.getElementById("datepicker");
var datePick = e.value;
<!--alert(datePick);-->
    if (strUser == 0  &&  datePick == '' ){
    alert("Please select month or date!");
    event.preventDefault();

    }





    }

<!--alert(monthSelect);-->


                    $(document).ready(function(){"use strict";$("#basic-datatable").DataTable({keys:!0,language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}});var a=$("#datatable-buttons").DataTable({lengthChange:!1,buttons:["copy","print"],language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}});$("#selection-datatable").DataTable({select:{style:"multi"},language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}}),a.buttons().container().appendTo("#datatable-buttons_wrapper .col-md-6:eq(0)"),$("#alternative-page-datatable").DataTable({pagingType:"full_numbers",drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}}),$("#scroll-vertical-datatable").DataTable({scrollY:"350px",scrollCollapse:!0,paging:!1,language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}}),$("#scroll-horizontal-datatable").DataTable({scrollX:!0,language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}}),$("#complex-header-datatable").DataTable({language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")},columnDefs:[{visible:!1,targets:-1}]}),$("#row-callback-datatable").DataTable({language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")},createdRow:function(a,e,t){15e4<+e[5].replace(/[\$,]/g,"")&&$("td",a).eq(5).addClass("text-danger")}}),$("#state-saving-datatable").DataTable({stateSave:!0,language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}}),$(".dataTables_length select").addClass("form-select form-select-sm"),$(".dataTables_length label").addClass("form-label")});



var applyStyle = function(e, cssClass){
    var tr = e.parent('tr');
    var index = e.index();

    e.addClass(cssClass);
    var daysRemainingInWeek = 6 - index;
    var carryOver = 6 - daysRemainingInWeek;

    for (var i=0; i<=daysRemainingInWeek; i++){
        var pos = index + i;
        tr.find('td:eq('+pos+')').addClass(cssClass);
    }

    if (carryOver > 0) {
        var nextTr = tr.next('tr');
        for (var i=0; i<carryOver; i++){
            nextTr.find('td:eq('+i+')').addClass(cssClass);
        }
    }
};

var highlightRange = function(e){
    var input = e.currentTarget;

    $('.week-active', '.datepicker-days').removeClass('week-active');
    var thisDay = $('td.active.day', '.datepicker-days');
    applyStyle(thisDay, 'week-active');

    var date = new Date(e.date);
    var start_date = moment(date);
    var end_date = moment(date).add(6, 'days');
    var friendly_string = start_date.format('MM-DD-YYYY') + ' to '
        + end_date.format('MM-DD-YYYY');

    $(input).val(friendly_string);

};

highlightRange({ currentTarget: document.getElementsByName('week')[0], date: new Date() });

$('input[name=week]').datepicker( {
    format: "mm-dd-yyyy",
    autoclose: true,
    orientation: 'top auto'
}).on('show', function(e){
    var td = $('td', '.datepicker-days');
    td.mouseover(function(){
        applyStyle($(this), 'week');
    }).mouseout(function(){
        $('.week', '.datepicker-days').removeClass('week');
    });

    highlightRange(e);
}).on('hide', function(e){
    highlightRange(e);
    console.log($(this).val());
});

$('.input-group-addon', '.week-select').click(function(){ $('input[name=week]').datepicker('show');  });

$('#datepicker').datepicker({
            uiLibrary: 'bootstrap4'
        });




                    </script>


                {% endblock %}